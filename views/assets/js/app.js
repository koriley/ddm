'use strict'; // remove line below when testing frontend

var fs = require('fs'); // Paths


var campaignListPath = "./campaign.json";
var bookPath = "./book/";
var campaignDirPath = "/campaigns/"; ///
//glodal objects

var books = {};
var npc = {};
var campaignObj = {}; ///
//global vars
///
//temp to cose the campaign picker.

jQuery(".closeCampWindow").on("click", function () {
  jQuery(".campaigns").remove();
});
jQuery("document").ready(function () {
  jQuery(".drag").draggable({
    containment: ".mainView",
    scroll: false
  });
});

Object.prototype.hasOwnProperty = function (property) {
  return this[property] !== undefined;
}; // getDirContents("./books").then(function (files) {
//   // console.log();
//   // console.log(JSON.parse(JSON.stringify(files.files[0].name)));
//   for(var i = 0; i <= files.files.length - 1; i++) {
//     readAFile("./books/" + JSON.parse(JSON.stringify(files.files[i].name))).then(function (book) {
//       var bookTitle = JSON.parse(book);
//       console.log(bookTitle.details.name);
//       jQuery(".bookList").append(`<div class="book">${bookTitle.details.name}<div>`);
//        //look for npc, this will eventually be its own function
//       if(bookTitle.hasOwnProperty("NPC")){
//         console.log(bookTitle.details.name+" true")
//       }else{
//         console.log("none found")
//       }
//     });
//   }
// });
"use strict";

jQuery(document).ready(function () {
  startApp().then(function (data) {
    console.log(data);
    console.log(campaignObj);
  });
});

function startApp() {
  return new Promise(function (resolve, reject) {
    try {
      getCampaigns(campaignListPath);
      resolve("startUp");
    } catch (error) {
      reject(error);
    }
  });
}
'use strict';

function readAFile(filepath) {
  return new Promise(function (resolve, reject) {
    fs.readFile(filepath, 'utf-8', function (err, data) {
      if (err) {
        reject("An error ocurred reading the file :" + err.message);
        return;
      } else {
        resolve(data);
      }
    });
  });
}

function writeFile(filepath, data) {
  return new Promise(function (resolve, reject) {
    fs.writeFile(filepath, data, function (err) {
      if (err) {
        reject(err);
      } else {
        resolve("File Written");
      }
    });
  });
}

function getDirContents(dir) {
  return new Promise(function (resolve, reject) {
    var files = {};
    var fileNames = [];

    try {
      fs.readdirSync(dir).forEach(function (fileName) {
        fileNames.push({
          "name": fileName
        });
        files = {
          "files": fileNames
        };
      });
      resolve(files);
    } catch (error) {
      reject(error);
    }
  });
}

function checkFileExist(path) {
  return new Promise(function (resolve, reject) {
    if (!path) {
      reject("Path is invalid " + path);
    }

    try {
      fs.access(path, fs.F_OK, function (err) {
        if (err) {
          resolve("false");
        }

        resolve("true");
      });
    } catch (error) {
      reject("error");
    }
  });
} //write test
// var testObj  = "This is a write test";
// writeFile("../test.txt", testObj);
"use strict";

function updateAbilityBonus(myAbility) {
  var ability = jQuery(myAbility).val();
  var modifier = jQuery(myAbility).parent().children('.modifier-bubble').text();

  if (!jQuery.isNumeric(ability)) {
    ability = 1;
    jQuery(myAbility).val(ability);
  }

  modifier = Math.floor((ability - 10) / 2);
  jQuery(myAbility).parent().children('.modifier-bubble').text(modifier);
}

;
jQuery(".ability").each(function () {
  updateAbilityBonus(jQuery(this));
  jQuery(this).on("focus", function () {
    jQuery(this).select();
  });
  jQuery(this).on("keyup", function () {
    updateAbilityBonus(jQuery(this));
    updateProf(jQuery('.savingThrows #' + jQuery(this).attr('id')));
  });
});
"use strict";

function clearTop() {
  jQuery(".drag").each(function () {
    jQuery(this).removeClass("onTop");
  });
}

;
jQuery(".drag").on("mousedown", function () {
  clearTop();
  jQuery(this).addClass("onTop");
});
"use strict";

jQuery(".campaignButton").click(function () {
  var type = jQuery(this).attr("data-campaign");

  if (type == "new") {
    console.log("clicked new you bastard");
    newCampaign();
  } else {
    console.log("coming soon");
  }
});
jQuery(".campaignSelectorBox").on("click", ".campDelete", function () {
  var toDelete = jQuery(this).attr("data-delete"); // console.log("clicked");
  //should add a are you sure popup

  console.log("delet this number " + toDelete + " and this is the object" + JSON.stringify(campaignObj.campaigns));
  campaignObj.campaigns.splice(toDelete);
  console.log(JSON.stringify(campaignObj));
  writeFile(campaignListPath, JSON.stringify(campaignObj)).then(function (data) {
    if (data == "File Written") {
      getCampaigns(campaignListPath);
    }
  });
});

function newCampaign() {}

function getCampaigns(path) {
  // console.log("getCampaigns " + path);
  checkFileExist(path).then(function (data) {
    // console.log(data);
    if (data == "true") {
      readAFile(path).then(function (campaigns) {
        campaigns = JSON.parse(campaigns);
        campaignObj = campaigns;
        setCampaigns(campaignObj);
      });
    }
  });
}

function setCampaigns(campaigns) {
  return new Promise(function (resolve, reject) {
    try {
      var campArray = campaigns.campaigns;
      var html = "<table>";
      campArray.forEach(function (node, i) {
        console.log(JSON.stringify(node)); // console.log(campaigns.campaigns[i].name)

        html += "<tr><td>" + campaigns.campaigns[i].name + "</td><td><button type='button' data-load='" + campaigns.campaigns[i].name + "' class='btn btn-primary campLoad'>Load</button><button type='button' data-delete='" + i + "' class='btn btn-primary campDelete'>Delete</button></td></tr>";
      });
      html += "</table>";
      jQuery(".campaignSelectorBox").html(html);
      resolve("setCampaigns");
    } catch (error) {
      reject(error);
    }
  });
}
"use strict";

jQuery(".close").click(function () {
  jQuery(this).parent().toggle();
});
jQuery(".menu button").click(function () {
  var openMe = jQuery(this).attr("data-open");
  jQuery("." + openMe).toggle();
  clearTop();
  jQuery("." + openMe).addClass("onTop");
});
"use strict";
"use strict";

var profB = jQuery('#profBonus').val();
somethingClever();
jQuery('#profBonus').on("keyup", function () {
  profB = jQuery('#profBonus').val();
  somethingClever();
});

function somethingClever() {
  jQuery('.icon-prof').each(function () {
    var classes = ['icon-prof', 'icon-prof proficient', 'icon-prof expertise'];
    var currentClass = jQuery(this).attr('class');
    var currentPos = jQuery.inArray(currentClass, classes);
    var myProf = jQuery(this).parent().children('.profVal');
    updateProf(jQuery(myProf), currentPos);
  });
}

function updateProf(myProf, myProfSkillFlag) {
  var thisAbility = jQuery(myProf).attr('id');
  var thisAbilityBonusID = '#' + thisAbility + '-Bonus';
  var thisAbilityBonus = jQuery('.abilities ' + thisAbilityBonusID).text();
  var newVal = parseInt(thisAbilityBonus);

  if (myProfSkillFlag == 0) {
    var newVal = parseInt(thisAbilityBonus);
  }

  if (myProfSkillFlag == 1) {
    var newVal = parseInt(profB) + parseInt(thisAbilityBonus);
  }

  if (myProfSkillFlag == 2) {
    var newVal = parseInt(profB) * 2 + parseInt(thisAbilityBonus);
  }

  jQuery(myProf).text(newVal);
}

;
jQuery('.icon-prof').click(function () {
  var classes = ['icon-prof', 'icon-prof proficient', 'icon-prof expertise'];
  var currentClass = jQuery(this).attr('class');
  var currentPos = jQuery.inArray(currentClass, classes);
  var newPos = (currentPos + 1) % classes.length;
  var newClass = classes[newPos];
  jQuery(this).attr('class', newClass);
  var myProf = jQuery(this).parent().children('.profVal');
  updateProf(jQuery(myProf), newPos);
});
"use strict";

//themes
var buttonOptions = ['default', 'black', 'gray', 'light', 'red'];
jQuery(buttonOptions).each(function () {
  var myStyle = this;
  var myId = '#' + myStyle;
  jQuery(myId).on("click", function () {
    $("body").removeAttr('class');
    jQuery('body').addClass('theme-' + myStyle);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAxX2FwcC5qcyIsIjAyX3N0YXJ0dXAuanMiLCIwM19pby5qcyIsImFiaWxpdHlCb251cy5qcyIsImNsaWNrVG9Gcm9udC5qcyIsImxvYWRDYW1wYWlnbi5qcyIsIm1lbnVCdXR0b25zLmpzIiwibnBjLmpzIiwicHJvZmljaWVuY2llcy5qcyIsInRoZW1lcy5qcyJdLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJjYW1wYWlnbkxpc3RQYXRoIiwiYm9va1BhdGgiLCJjYW1wYWlnbkRpclBhdGgiLCJib29rcyIsIm5wYyIsImNhbXBhaWduT2JqIiwialF1ZXJ5Iiwib24iLCJyZW1vdmUiLCJyZWFkeSIsImRyYWdnYWJsZSIsImNvbnRhaW5tZW50Iiwic2Nyb2xsIiwiT2JqZWN0IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwcm9wZXJ0eSIsInVuZGVmaW5lZCIsImRvY3VtZW50Iiwic3RhcnRBcHAiLCJ0aGVuIiwiZGF0YSIsImNvbnNvbGUiLCJsb2ciLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImdldENhbXBhaWducyIsImVycm9yIiwicmVhZEFGaWxlIiwiZmlsZXBhdGgiLCJyZWFkRmlsZSIsImVyciIsIm1lc3NhZ2UiLCJ3cml0ZUZpbGUiLCJnZXREaXJDb250ZW50cyIsImRpciIsImZpbGVzIiwiZmlsZU5hbWVzIiwicmVhZGRpclN5bmMiLCJmb3JFYWNoIiwiZmlsZU5hbWUiLCJwdXNoIiwiY2hlY2tGaWxlRXhpc3QiLCJwYXRoIiwiYWNjZXNzIiwiRl9PSyIsInVwZGF0ZUFiaWxpdHlCb251cyIsIm15QWJpbGl0eSIsImFiaWxpdHkiLCJ2YWwiLCJtb2RpZmllciIsInBhcmVudCIsImNoaWxkcmVuIiwidGV4dCIsImlzTnVtZXJpYyIsIk1hdGgiLCJmbG9vciIsImVhY2giLCJzZWxlY3QiLCJ1cGRhdGVQcm9mIiwiYXR0ciIsImNsZWFyVG9wIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsImNsaWNrIiwidHlwZSIsIm5ld0NhbXBhaWduIiwidG9EZWxldGUiLCJKU09OIiwic3RyaW5naWZ5IiwiY2FtcGFpZ25zIiwic3BsaWNlIiwicGFyc2UiLCJzZXRDYW1wYWlnbnMiLCJjYW1wQXJyYXkiLCJodG1sIiwibm9kZSIsImkiLCJuYW1lIiwidG9nZ2xlIiwib3Blbk1lIiwicHJvZkIiLCJzb21ldGhpbmdDbGV2ZXIiLCJjbGFzc2VzIiwiY3VycmVudENsYXNzIiwiY3VycmVudFBvcyIsImluQXJyYXkiLCJteVByb2YiLCJteVByb2ZTa2lsbEZsYWciLCJ0aGlzQWJpbGl0eSIsInRoaXNBYmlsaXR5Qm9udXNJRCIsInRoaXNBYmlsaXR5Qm9udXMiLCJuZXdWYWwiLCJwYXJzZUludCIsIm5ld1BvcyIsImxlbmd0aCIsIm5ld0NsYXNzIiwiYnV0dG9uT3B0aW9ucyIsIm15U3R5bGUiLCJteUlkIiwiJCIsInJlbW92ZUF0dHIiXSwibWFwcGluZ3MiOiJBQUFBLGEsQ0FDRTs7QUFDQSxJQUFJQSxFQUFFLEdBQUdDLE9BQU8sQ0FBQyxJQUFELENBQWhCLEMsQ0FFRjs7O0FBQ0EsSUFBSUMsZ0JBQWdCLEdBQUcsaUJBQXZCO0FBQ0EsSUFBSUMsUUFBUSxHQUFHLFNBQWY7QUFDQSxJQUFJQyxlQUFlLEdBQUcsYUFBdEIsQyxDQUVBO0FBRUE7O0FBQ0EsSUFBSUMsS0FBSyxHQUFHLEVBQVo7QUFDQSxJQUFJQyxHQUFHLEdBQUcsRUFBVjtBQUNBLElBQUlDLFdBQVcsR0FBRyxFQUFsQixDLENBQ0E7QUFFQTtBQUVBO0FBRUE7O0FBQ0FDLE1BQU0sQ0FBQyxrQkFBRCxDQUFOLENBQTJCQyxFQUEzQixDQUE4QixPQUE5QixFQUF1QyxZQUFVO0FBQy9DRCxFQUFBQSxNQUFNLENBQUMsWUFBRCxDQUFOLENBQXFCRSxNQUFyQjtBQUNELENBRkQ7QUFJQUYsTUFBTSxDQUFDLFVBQUQsQ0FBTixDQUFtQkcsS0FBbkIsQ0FBeUIsWUFBWTtBQUNuQ0gsRUFBQUEsTUFBTSxDQUFDLE9BQUQsQ0FBTixDQUFnQkksU0FBaEIsQ0FBMEI7QUFDdEJDLElBQUFB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QTZCLE9BQTdCLEVBQXNDLEtBQXRDLENBQXBCO0FBQ0E1RixNQUFNLENBQUM0RixhQUFELENBQU4sQ0FBc0J4QyxJQUF0QixDQUEyQixZQUFXO0FBQ2xDLE1BQUl5QyxPQUFPLEdBQUcsSUFBZDtBQUNBLE1BQUlDLElBQUksR0FBRyxNQUFNRCxPQUFqQjtBQUNBN0YsRUFBQUEsTUFBTSxDQUFDOEYsSUFBRCxDQUFOLENBQWE3RixFQUFiLENBQWdCLE9BQWhCLEVBQXlCLFlBQVc7QUFDaEM4RixJQUFBQSxDQUFDLENBQUMsTUFBRCxDQUFELENBQVVDLFVBQVYsQ0FBcUIsT0FBckI7QUFDQWhHLElBQUFBLE1BQU0sQ0FBQyxNQUFELENBQU4sQ0FBZTBELFFBQWYsQ0FBd0IsV0FBV21DLE9BQW5DO0FBQ0gsR0FIRDtBQUlILENBUEQiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuICAvLyByZW1vdmUgbGluZSBiZWxvdyB3aGVuIHRlc3RpbmcgZnJvbnRlbmRcbiAgdmFyIGZzID0gcmVxdWlyZSgnZnMnKTtcbiAgXG4vLyBQYXRoc1xubGV0IGNhbXBhaWduTGlzdFBhdGggPSBcIi4vY2FtcGFpZ24uanNvblwiO1xubGV0IGJvb2tQYXRoID0gXCIuL2Jvb2svXCI7XG5sZXQgY2FtcGFpZ25EaXJQYXRoID0gXCIvY2FtcGFpZ25zL1wiO1xuXG4vLy9cblxuLy9nbG9kYWwgb2JqZWN0c1xudmFyIGJvb2tzID0ge307XG52YXIgbnBjID0ge307XG52YXIgY2FtcGFpZ25PYmogPSB7fTtcbi8vL1xuXG4vL2dsb2JhbCB2YXJzXG5cbi8vL1xuXG4vL3RlbXAgdG8gY29zZSB0aGUgY2FtcGFpZ24gcGlja2VyLlxualF1ZXJ5KFwiLmNsb3NlQ2FtcFdpbmRvd1wiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKCl7XG4gIGpRdWVyeShcIi5jYW1wYWlnbnNcIikucmVtb3ZlKCk7XG59KTtcblxualF1ZXJ5KFwiZG9jdW1lbnRcIikucmVhZHkoZnVuY3Rpb24gKCkge1xuICBqUXVlcnkoXCIuZHJhZ1wiKS5kcmFnZ2FibGUoe1xuICAgICAgY29udGFpbm1lbnQ6IFwiLm1haW5WaWV3XCIsXG4gICAgICBzY3JvbGw6IGZhbHNlXG4gIH0pO1xuXG5cbn0pO1xuXG5PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5ID0gZnVuY3Rpb24ocHJvcGVydHkpIHtcbnJldHVybiB0aGlzW3Byb3BlcnR5XSAhPT0gdW5kZWZpbmVkO1xufTtcblxuLy8gZ2V0RGlyQ29udGVudHMoXCIuL2Jvb2tzXCIpLnRoZW4oZnVuY3Rpb24gKGZpbGVzKSB7XG4vLyAgIC8vIGNvbnNvbGUubG9nKCk7XG4vLyAgIC8vIGNvbnNvbGUubG9nKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZmlsZXMuZmlsZXNbMF0ubmFtZSkpKTtcbi8vICAgZm9yKHZhciBpID0gMDsgaSA8PSBmaWxlcy5maWxlcy5sZW5ndGggLSAxOyBpKyspIHtcbi8vICAgICByZWFkQUZpbGUoXCIuL2Jvb2tzL1wiICsgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShmaWxlcy5maWxlc1tpXS5uYW1lKSkpLnRoZW4oZnVuY3Rpb24gKGJvb2spIHtcbi8vICAgICAgIHZhciBib29rVGl0bGUgPSBKU09OLnBhcnNlKGJvb2spO1xuLy8gICAgICAgY29uc29sZS5sb2coYm9va1RpdGxlLmRldGFpbHMubmFtZSk7XG4vLyAgICAgICBqUXVlcnkoXCIuYm9va0xpc3RcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiYm9va1wiPiR7Ym9va1RpdGxlLmRldGFpbHMubmFtZX08ZGl2PmApO1xuXG4vLyAgICAgICAgLy9sb29rIGZvciBucGMsIHRoaXMgd2lsbCBldmVudHVhbGx5IGJlIGl0cyBvd24gZnVuY3Rpb25cbi8vICAgICAgIGlmKGJvb2tUaXRsZS5oYXNPd25Qcm9wZXJ0eShcIk5QQ1wiKSl7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKGJvb2tUaXRsZS5kZXRhaWxzLm5hbWUrXCIgdHJ1ZVwiKVxuLy8gICAgICAgfWVsc2V7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKFwibm9uZSBmb3VuZFwiKVxuLy8gICAgICAgfVxuXG4vLyAgICAgfSk7XG4gICBcblxuXG4vLyAgIH1cbi8vIH0pO1xuXG4iLCJqUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XG4gIFxuICBzdGFydEFwcCgpLnRoZW4oKGRhdGEpPT57XG4gICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgY29uc29sZS5sb2coY2FtcGFpZ25PYmopXG4gIH0pO1xuIFxuICB9KVxuICBcblxuICBmdW5jdGlvbiBzdGFydEFwcCgpe1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KT0+e1xuICAgICAgdHJ5e1xuICAgICAgICBnZXRDYW1wYWlnbnMoY2FtcGFpZ25MaXN0UGF0aCk7XG4gICAgICAgIHJlc29sdmUoXCJzdGFydFVwXCIpO1xuICAgICAgfSBjYXRjaCAoZXJyb3Ipe1xuICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgfVxuICAgIH0pXG4gICAgXG4gIH0iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIHJlYWRBRmlsZShmaWxlcGF0aCl7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgZnMucmVhZEZpbGUoZmlsZXBhdGgsICd1dGYtOCcsIGZ1bmN0aW9uKGVyciwgZGF0YSkge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHJlamVjdChcIkFuIGVycm9yIG9jdXJyZWQgcmVhZGluZyB0aGUgZmlsZSA6XCIgKyBlcnIubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gd3JpdGVGaWxlKGZpbGVwYXRoLCBkYXRhKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGZzLndyaXRlRmlsZShmaWxlcGF0aCwgZGF0YSwgKGVycikgPT4ge1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgIHJlc29sdmUoXCJGaWxlIFdyaXR0ZW5cIik7XG4gICAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSlcbn1cblxuZnVuY3Rpb24gZ2V0RGlyQ29udGVudHMoZGlyKXtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk9PntcbiAgICAgICAgdmFyIGZpbGVzID0ge307XG4gICAgICAgIHZhciBmaWxlTmFtZXMgPSBbXTtcbiAgICAgICAgdHJ5e1xuICAgICAgICAgICAgZnMucmVhZGRpclN5bmMoZGlyKS5mb3JFYWNoKChmaWxlTmFtZSk9PntcbiAgICAgICAgICAgICAgICBmaWxlTmFtZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOmZpbGVOYW1lXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBmaWxlcyA9IHtcImZpbGVzXCI6ZmlsZU5hbWVzfVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlc29sdmUoZmlsZXMpO1xuICAgICAgICB9Y2F0Y2goZXJyb3Ipe1xuICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9KVxufVxuXG5mdW5jdGlvbiBjaGVja0ZpbGVFeGlzdChwYXRoKXtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk9PntcbiAgICAgICBpZighcGF0aCl7XG4gICAgICAgICAgICAgcmVqZWN0KFwiUGF0aCBpcyBpbnZhbGlkIFwiK3BhdGgpXG4gICAgICAgIH1cbiAgICAgICAgdHJ5e1xuICAgICAgICAgICAgZnMuYWNjZXNzKHBhdGgsIGZzLkZfT0ssIChlcnIpPT57XG4gICAgICAgICAgICAgICAgaWYoZXJyKXtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShcImZhbHNlXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNvbHZlKFwidHJ1ZVwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9Y2F0Y2ggKGVycm9yKXtcbiAgICAgICAgICAgIHJlamVjdChcImVycm9yXCIpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG4vL3dyaXRlIHRlc3Rcbi8vIHZhciB0ZXN0T2JqICA9IFwiVGhpcyBpcyBhIHdyaXRlIHRlc3RcIjtcbi8vIHdyaXRlRmlsZShcIi4uL3Rlc3QudHh0XCIsIHRlc3RPYmopO1xuIiwiXG5mdW5jdGlvbiB1cGRhdGVBYmlsaXR5Qm9udXMobXlBYmlsaXR5KSB7XG4gICAgdmFyIGFiaWxpdHkgPSBqUXVlcnkobXlBYmlsaXR5KS52YWwoKTtcblxuICAgIHZhciBtb2RpZmllciA9IGpRdWVyeShteUFiaWxpdHkpLnBhcmVudCgpLmNoaWxkcmVuKCcubW9kaWZpZXItYnViYmxlJykudGV4dCgpO1xuICAgIGlmICghalF1ZXJ5LmlzTnVtZXJpYyhhYmlsaXR5KSkge1xuICAgICAgICBhYmlsaXR5ID0gMTtcbiAgICAgICAgalF1ZXJ5KG15QWJpbGl0eSkudmFsKGFiaWxpdHkpO1xuICAgIH1cblxuICAgIG1vZGlmaWVyID0gTWF0aC5mbG9vcigoYWJpbGl0eSAtIDEwKSAvIDIpO1xuICAgIGpRdWVyeShteUFiaWxpdHkpLnBhcmVudCgpLmNoaWxkcmVuKCcubW9kaWZpZXItYnViYmxlJykudGV4dChtb2RpZmllcik7XG59O1xuXG5cbmpRdWVyeShcIi5hYmlsaXR5XCIpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgdXBkYXRlQWJpbGl0eUJvbnVzKGpRdWVyeSh0aGlzKSk7XG5cbiAgICBqUXVlcnkodGhpcykub24oXCJmb2N1c1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgalF1ZXJ5KHRoaXMpLnNlbGVjdCgpO1xuICAgIH0pXG4gICAgalF1ZXJ5KHRoaXMpLm9uKFwia2V5dXBcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgIHVwZGF0ZUFiaWxpdHlCb251cyhqUXVlcnkodGhpcykpO1xuICAgICAgICB1cGRhdGVQcm9mKGpRdWVyeSgnLnNhdmluZ1Rocm93cyAjJytqUXVlcnkodGhpcykuYXR0cignaWQnKSkpO1xuICAgIH0pO1xufSk7XG4iLCJmdW5jdGlvbiBjbGVhclRvcCgpIHtcbiAgICBqUXVlcnkoXCIuZHJhZ1wiKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICBqUXVlcnkodGhpcykucmVtb3ZlQ2xhc3MoXCJvblRvcFwiKTtcbiAgICB9KTtcbn07XG5cbmpRdWVyeShcIi5kcmFnXCIpLm9uKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKCkge1xuICAgIGNsZWFyVG9wKCk7XG4gICAgalF1ZXJ5KHRoaXMpLmFkZENsYXNzKFwib25Ub3BcIik7XG59KTtcbiIsImpRdWVyeShcIi5jYW1wYWlnbkJ1dHRvblwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHR5cGUgPSBqUXVlcnkodGhpcykuYXR0cihcImRhdGEtY2FtcGFpZ25cIik7XG4gICAgaWYgKHR5cGUgPT0gXCJuZXdcIikge1xuICAgICAgICBjb25zb2xlLmxvZyhcImNsaWNrZWQgbmV3IHlvdSBiYXN0YXJkXCIpXG4gICAgICAgIG5ld0NhbXBhaWduKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJjb21pbmcgc29vblwiKTtcbiAgICB9XG59KTtcblxualF1ZXJ5KFwiLmNhbXBhaWduU2VsZWN0b3JCb3hcIikub24oXCJjbGlja1wiLCBcIi5jYW1wRGVsZXRlXCIsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdG9EZWxldGUgPSBqUXVlcnkodGhpcykuYXR0cihcImRhdGEtZGVsZXRlXCIpO1xuICAgIC8vIGNvbnNvbGUubG9nKFwiY2xpY2tlZFwiKTtcbiAgICAvL3Nob3VsZCBhZGQgYSBhcmUgeW91IHN1cmUgcG9wdXBcbiAgICBjb25zb2xlLmxvZyhcImRlbGV0IHRoaXMgbnVtYmVyIFwiICsgdG9EZWxldGUgKyBcIiBhbmQgdGhpcyBpcyB0aGUgb2JqZWN0XCIgKyBKU09OLnN0cmluZ2lmeShjYW1wYWlnbk9iai5jYW1wYWlnbnMpKTtcbiAgICBjYW1wYWlnbk9iai5jYW1wYWlnbnMuc3BsaWNlKHRvRGVsZXRlKTtcbiAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShjYW1wYWlnbk9iaikpO1xuICAgIHdyaXRlRmlsZShjYW1wYWlnbkxpc3RQYXRoLCBKU09OLnN0cmluZ2lmeShjYW1wYWlnbk9iaikpLnRoZW4oKGRhdGEpPT57XG4gICAgICAgIGlmKGRhdGEgPT0gXCJGaWxlIFdyaXR0ZW5cIil7XG4gICAgICAgICAgICBnZXRDYW1wYWlnbnMoY2FtcGFpZ25MaXN0UGF0aCk7XG4gICAgICAgIH1cbiAgICB9KVxuXG59KVxuXG5mdW5jdGlvbiBuZXdDYW1wYWlnbigpIHtcblxuXG59XG5cbmZ1bmN0aW9uIGdldENhbXBhaWducyhwYXRoKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJnZXRDYW1wYWlnbnMgXCIgKyBwYXRoKTtcbiAgICBjaGVja0ZpbGVFeGlzdChwYXRoKS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICBpZiAoZGF0YSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgcmVhZEFGaWxlKHBhdGgpLnRoZW4oKGNhbXBhaWducykgPT4ge1xuICAgICAgICAgICAgICAgIGNhbXBhaWducyA9IEpTT04ucGFyc2UoY2FtcGFpZ25zKTtcbiAgICAgICAgICAgICAgICBjYW1wYWlnbk9iaiA9IGNhbXBhaWducztcbiAgICAgICAgICAgICAgICBzZXRDYW1wYWlnbnMoY2FtcGFpZ25PYmopXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBzZXRDYW1wYWlnbnMoY2FtcGFpZ25zKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciBjYW1wQXJyYXkgPSBjYW1wYWlnbnMuY2FtcGFpZ25zO1xuICAgICAgICAgICAgdmFyIGh0bWwgPSBcIjx0YWJsZT5cIjtcbiAgICAgICAgICAgIGNhbXBBcnJheS5mb3JFYWNoKGZ1bmN0aW9uIChub2RlLCBpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkobm9kZSkpXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coY2FtcGFpZ25zLmNhbXBhaWduc1tpXS5uYW1lKVxuICAgICAgICAgICAgICAgIGh0bWwgKz0gXCI8dHI+PHRkPlwiICsgY2FtcGFpZ25zLmNhbXBhaWduc1tpXS5uYW1lICsgXCI8L3RkPjx0ZD48YnV0dG9uIHR5cGU9J2J1dHRvbicgZGF0YS1sb2FkPSdcIiArIGNhbXBhaWducy5jYW1wYWlnbnNbaV0ubmFtZSArIFwiJyBjbGFzcz0nYnRuIGJ0bi1wcmltYXJ5IGNhbXBMb2FkJz5Mb2FkPC9idXR0b24+PGJ1dHRvbiB0eXBlPSdidXR0b24nIGRhdGEtZGVsZXRlPSdcIiArIGkgKyBcIicgY2xhc3M9J2J0biBidG4tcHJpbWFyeSBjYW1wRGVsZXRlJz5EZWxldGU8L2J1dHRvbj48L3RkPjwvdHI+XCI7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgaHRtbCArPSBcIjwvdGFibGU+XCI7XG4gICAgICAgICAgICBqUXVlcnkoXCIuY2FtcGFpZ25TZWxlY3RvckJveFwiKS5odG1sKGh0bWwpO1xuICAgICAgICAgICAgcmVzb2x2ZShcInNldENhbXBhaWduc1wiKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgIH1cbiAgICB9KTtcbn0iLCJqUXVlcnkoXCIuY2xvc2VcIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgIGpRdWVyeSh0aGlzKS5wYXJlbnQoKS50b2dnbGUoKTtcbn0pXG5qUXVlcnkoXCIubWVudSBidXR0b25cIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgIHZhciBvcGVuTWUgPSBqUXVlcnkodGhpcykuYXR0cihcImRhdGEtb3BlblwiKTtcbiAgICBqUXVlcnkoXCIuXCIgKyBvcGVuTWUpLnRvZ2dsZSgpO1xuICAgIGNsZWFyVG9wKCk7XG4gICAgalF1ZXJ5KFwiLlwiICsgb3Blbk1lKS5hZGRDbGFzcyhcIm9uVG9wXCIpO1xufSk7IiwiIiwidmFyIHByb2ZCID0galF1ZXJ5KCcjcHJvZkJvbnVzJykudmFsKCk7XG5zb21ldGhpbmdDbGV2ZXIoKTtcblxualF1ZXJ5KCcjcHJvZkJvbnVzJykub24oXCJrZXl1cFwiLCBmdW5jdGlvbigpIHtcbiAgICBwcm9mQiA9IGpRdWVyeSgnI3Byb2ZCb251cycpLnZhbCgpO1xuICAgIHNvbWV0aGluZ0NsZXZlcigpO1xufSk7XG5cbmZ1bmN0aW9uIHNvbWV0aGluZ0NsZXZlcigpIHtcbiAgICBqUXVlcnkoJy5pY29uLXByb2YnKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY2xhc3NlcyA9IFsnaWNvbi1wcm9mJywgJ2ljb24tcHJvZiBwcm9maWNpZW50JywgJ2ljb24tcHJvZiBleHBlcnRpc2UnXTtcbiAgICAgICAgdmFyIGN1cnJlbnRDbGFzcyA9IGpRdWVyeSh0aGlzKS5hdHRyKCdjbGFzcycpO1xuICAgICAgICB2YXIgY3VycmVudFBvcyA9IGpRdWVyeS5pbkFycmF5KGN1cnJlbnRDbGFzcywgY2xhc3Nlcyk7XG4gICAgICAgIHZhciBteVByb2YgPSBqUXVlcnkodGhpcykucGFyZW50KCkuY2hpbGRyZW4oJy5wcm9mVmFsJyk7XG4gICAgICAgIHVwZGF0ZVByb2YoalF1ZXJ5KG15UHJvZiksIGN1cnJlbnRQb3MpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVQcm9mKG15UHJvZiwgbXlQcm9mU2tpbGxGbGFnKSB7XG4gICAgdmFyIHRoaXNBYmlsaXR5ID0galF1ZXJ5KG15UHJvZikuYXR0cignaWQnKTtcbiAgICB2YXIgdGhpc0FiaWxpdHlCb251c0lEID0gJyMnICsgdGhpc0FiaWxpdHkgKyAnLUJvbnVzJztcbiAgICB2YXIgdGhpc0FiaWxpdHlCb251cyA9IGpRdWVyeSgnLmFiaWxpdGllcyAnICsgdGhpc0FiaWxpdHlCb251c0lEKS50ZXh0KCk7XG4gICAgdmFyIG5ld1ZhbCA9IHBhcnNlSW50KHRoaXNBYmlsaXR5Qm9udXMpO1xuICAgIGlmIChteVByb2ZTa2lsbEZsYWcgPT0gMCkge1xuICAgICAgICB2YXIgbmV3VmFsID0gcGFyc2VJbnQodGhpc0FiaWxpdHlCb251cyk7XG4gICAgfVxuICAgIGlmIChteVByb2ZTa2lsbEZsYWcgPT0gMSkge1xuICAgICAgICB2YXIgbmV3VmFsID0gcGFyc2VJbnQocHJvZkIpICsgcGFyc2VJbnQodGhpc0FiaWxpdHlCb251cyk7XG4gICAgfVxuICAgIGlmIChteVByb2ZTa2lsbEZsYWcgPT0gMikge1xuICAgICAgICB2YXIgbmV3VmFsID0gcGFyc2VJbnQocHJvZkIpICogMiArIChwYXJzZUludCh0aGlzQWJpbGl0eUJvbnVzKSk7XG4gICAgfVxuICAgIGpRdWVyeShteVByb2YpLnRleHQobmV3VmFsKTtcbn07XG5cblxualF1ZXJ5KCcuaWNvbi1wcm9mJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNsYXNzZXMgPSBbJ2ljb24tcHJvZicsICdpY29uLXByb2YgcHJvZmljaWVudCcsICdpY29uLXByb2YgZXhwZXJ0aXNlJ107XG4gICAgdmFyIGN1cnJlbnRDbGFzcyA9IGpRdWVyeSh0aGlzKS5hdHRyKCdjbGFzcycpO1xuICAgIHZhciBjdXJyZW50UG9zID0galF1ZXJ5LmluQXJyYXkoY3VycmVudENsYXNzLCBjbGFzc2VzKTtcbiAgICB2YXIgbmV3UG9zID0gKChjdXJyZW50UG9zICsgMSkgJSBjbGFzc2VzLmxlbmd0aCk7XG4gICAgdmFyIG5ld0NsYXNzID0gY2xhc3Nlc1tuZXdQb3NdO1xuICAgIGpRdWVyeSh0aGlzKS5hdHRyKCdjbGFzcycsIG5ld0NsYXNzKTtcbiAgICB2YXIgbXlQcm9mID0galF1ZXJ5KHRoaXMpLnBhcmVudCgpLmNoaWxkcmVuKCcucHJvZlZhbCcpO1xuICAgIHVwZGF0ZVByb2YoalF1ZXJ5KG15UHJvZiksIG5ld1Bvcyk7XG59KTtcbiIsIi8vdGhlbWVzXG52YXIgYnV0dG9uT3B0aW9ucyA9IFsnZGVmYXVsdCcsICdibGFjaycsICdncmF5JywgJ2xpZ2h0JywgJ3JlZCddO1xualF1ZXJ5KGJ1dHRvbk9wdGlvbnMpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgdmFyIG15U3R5bGUgPSB0aGlzO1xuICAgIHZhciBteUlkID0gJyMnICsgbXlTdHlsZTtcbiAgICBqUXVlcnkobXlJZCkub24oXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJChcImJvZHlcIikucmVtb3ZlQXR0cignY2xhc3MnKTtcbiAgICAgICAgalF1ZXJ5KCdib2R5JykuYWRkQ2xhc3MoJ3RoZW1lLScgKyBteVN0eWxlKTtcbiAgICB9KVxufSlcbiJdfQ==
