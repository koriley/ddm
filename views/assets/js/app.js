'use strict'; // remove line below when testing frontend

var fs = require('fs'); // Paths


var campaignListPath = "./campaign.json";
var bookPath = "./book/";
var campaignDirPath = "/campaigns/"; ///
//glodal objects

var books = {};
var npc = {};
var campaignObj = {}; ///
//global vars
///

jQuery("document").ready(function () {
  jQuery(".drag").draggable({
    containment: ".mainView",
    scroll: false
  });
});

Object.prototype.hasOwnProperty = function (property) {
  return this[property] !== undefined;
}; // getDirContents("./books").then(function (files) {
//   // console.log();
//   // console.log(JSON.parse(JSON.stringify(files.files[0].name)));
//   for(var i = 0; i <= files.files.length - 1; i++) {
//     readAFile("./books/" + JSON.parse(JSON.stringify(files.files[i].name))).then(function (book) {
//       var bookTitle = JSON.parse(book);
//       console.log(bookTitle.details.name);
//       jQuery(".bookList").append(`<div class="book">${bookTitle.details.name}<div>`);
//        //look for npc, this will eventually be its own function
//       if(bookTitle.hasOwnProperty("NPC")){
//         console.log(bookTitle.details.name+" true")
//       }else{
//         console.log("none found")
//       }
//     });
//   }
// });
"use strict";

jQuery(document).ready(function () {
  startApp().then(function (data) {
    console.log(data);
    console.log(campaignObj);
  });
});

function startApp() {
  return new Promise(function (resolve, reject) {
    try {
      getCampaigns(campaignListPath);
      resolve("startUp");
    } catch (error) {
      reject(error);
    }
  });
}
'use strict';

function readAFile(filepath) {
  return new Promise(function (resolve, reject) {
    fs.readFile(filepath, 'utf-8', function (err, data) {
      if (err) {
        reject("An error ocurred reading the file :" + err.message);
        return;
      } else {
        resolve(data);
      }
    });
  });
}

function writeFile(filepath, data) {
  return new Promise(function (resolve, reject) {
    fs.writeFile(filepath, data, function (err) {
      if (err) {
        reject(err);
      }
    });
  });
}

function getDirContents(dir) {
  return new Promise(function (resolve, reject) {
    var files = {};
    var fileNames = [];

    try {
      fs.readdirSync(dir).forEach(function (fileName) {
        fileNames.push({
          "name": fileName
        });
        files = {
          "files": fileNames
        };
      });
      resolve(files);
    } catch (error) {
      reject(error);
    }
  });
}

function checkFileExist(path) {
  return new Promise(function (resolve, reject) {
    if (!path) {
      reject("Path is invalid " + path);
    }

    try {
      fs.access(path, fs.F_OK, function (err) {
        if (err) {
          resolve("false");
        }

        resolve("true");
      });
    } catch (error) {
      reject("error");
    }
  });
} //write test
// var testObj  = "This is a write test";
// writeFile("../test.txt", testObj);
"use strict";

function updateAbilityBonus(myAbility) {
  var ability = jQuery(myAbility).val();
  var modifier = jQuery(myAbility).parent().children('.modifier-bubble').text();

  if (!jQuery.isNumeric(ability)) {
    ability = 1;
    jQuery(myAbility).val(ability);
  }

  modifier = Math.floor((ability - 10) / 2);
  jQuery(myAbility).parent().children('.modifier-bubble').text(modifier);
}

;
jQuery(".ability").each(function () {
  updateAbilityBonus(jQuery(this));
  jQuery(this).on("focus", function () {
    jQuery(this).select();
  });
  jQuery(this).on("keyup", function () {
    updateAbilityBonus(jQuery(this));
    updateProf(jQuery('.savingThrows #' + jQuery(this).attr('id')));
  });
});
"use strict";

function clearTop() {
  jQuery(".drag").each(function () {
    jQuery(this).removeClass("onTop");
  });
}

;
jQuery(".drag").on("mousedown", function () {
  clearTop();
  jQuery(this).addClass("onTop");
});
"use strict";

jQuery(".campaignButton").click(function () {
  var type = jQuery(this).attr("data-campaign");

  if (type == "new") {
    console.log("clicked new you bastard");
    newCampaign();
  } else {
    console.log("coming soon");
  }
});
jQuery(".campDelete").click(function () {
  var toDelete = jQuery(this).attr("data-delete");
  console.log("delet this number " + toDelete + " and this is the object" + JSON.stringify(campaignObj));
});

function newCampaign() {}

function getCampaigns(path) {
  // console.log("getCampaigns " + path);
  checkFileExist(path).then(function (data) {
    // console.log(data);
    if (data == "true") {
      readAFile(path).then(function (campaigns) {
        campaigns = JSON.parse(campaigns);
        campaignObj = campaigns;
        console.log(JSON.stringify(campaigns));
        var campArray = campaigns.campaigns;
        console.log(campaigns.campaigns[0].name);
        var html = "<table>";
        campArray.forEach(function (node, i) {
          console.log(campaigns.campaigns[i].name);
          html += "<tr><td>" + campaigns.campaigns[i].name + "</td><td><button type='button' data-load='" + campaigns.campaigns[i].name + "' class='btn btn-primary campLoad'>Load</button><button type='button' data-delete='" + i + "' class='btn btn-primary campDelete'>Delete</button></td></tr>";
        });
        html += "</table>";
        jQuery(".campaignSelectorBox").html(html);
        return "campaigns set";
      });
    }
  });
}
"use strict";

jQuery(".close").click(function () {
  jQuery(this).parent().toggle();
});
jQuery(".menu button").click(function () {
  var openMe = jQuery(this).attr("data-open");
  jQuery("." + openMe).toggle();
  clearTop();
  jQuery("." + openMe).addClass("onTop");
});
"use strict";
"use strict";

var profB = jQuery('#profBonus').val();
somethingClever();
jQuery('#profBonus').on("keyup", function () {
  profB = jQuery('#profBonus').val();
  somethingClever();
});

function somethingClever() {
  jQuery('.icon-prof').each(function () {
    var classes = ['icon-prof', 'icon-prof proficient', 'icon-prof expertise'];
    var currentClass = jQuery(this).attr('class');
    var currentPos = jQuery.inArray(currentClass, classes);
    var myProf = jQuery(this).parent().children('.profVal');
    updateProf(jQuery(myProf), currentPos);
  });
}

function updateProf(myProf, myProfSkillFlag) {
  var thisAbility = jQuery(myProf).attr('id');
  var thisAbilityBonusID = '#' + thisAbility + '-Bonus';
  var thisAbilityBonus = jQuery('.abilities ' + thisAbilityBonusID).text();
  var newVal = parseInt(thisAbilityBonus);

  if (myProfSkillFlag == 0) {
    var newVal = parseInt(thisAbilityBonus);
  }

  if (myProfSkillFlag == 1) {
    var newVal = parseInt(profB) + parseInt(thisAbilityBonus);
  }

  if (myProfSkillFlag == 2) {
    var newVal = parseInt(profB) * 2 + parseInt(thisAbilityBonus);
  }

  jQuery(myProf).text(newVal);
}

;
jQuery('.icon-prof').click(function () {
  var classes = ['icon-prof', 'icon-prof proficient', 'icon-prof expertise'];
  var currentClass = jQuery(this).attr('class');
  var currentPos = jQuery.inArray(currentClass, classes);
  var newPos = (currentPos + 1) % classes.length;
  var newClass = classes[newPos];
  jQuery(this).attr('class', newClass);
  var myProf = jQuery(this).parent().children('.profVal');
  updateProf(jQuery(myProf), newPos);
});
"use strict";

//themes
var buttonOptions = ['default', 'black', 'gray', 'light', 'red'];
jQuery(buttonOptions).each(function () {
  var myStyle = this;
  var myId = '#' + myStyle;
  jQuery(myId).on("click", function () {
    $("body").removeAttr('class');
    jQuery('body').addClass('theme-' + myStyle);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAxX2FwcC5qcyIsIjAyX3N0YXJ0dXAuanMiLCIwM19pby5qcyIsImFiaWxpdHlCb251cy5qcyIsImNsaWNrVG9Gcm9udC5qcyIsImxvYWRDYW1wYWlnbi5qcyIsIm1lbnVCdXR0b25zLmpzIiwibnBjLmpzIiwicHJvZmljaWVuY2llcy5qcyIsInRoZW1lcy5qcyJdLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJjYW1wYWlnbkxpc3RQYXRoIiwiYm9va1BhdGgiLCJjYW1wYWlnbkRpclBhdGgiLCJib29rcyIsIm5wYyIsImNhbXBhaWduT2JqIiwialF1ZXJ5IiwicmVhZHkiLCJkcmFnZ2FibGUiLCJjb250YWlubWVudCIsInNjcm9sbCIsIk9iamVjdCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicHJvcGVydHkiLCJ1bmRlZmluZWQiLCJkb2N1bWVudCIsInN0YXJ0QXBwIiwidGhlbiIsImRhdGEiLCJjb25zb2xlIiwibG9nIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJnZXRDYW1wYWlnbnMiLCJlcnJvciIsInJlYWRBRmlsZSIsImZpbGVwYXRoIiwicmVhZEZpbGUiLCJlcnIiLCJtZXNzYWdlIiwid3JpdGVGaWxlIiwiZ2V0RGlyQ29udGVudHMiLCJkaXIiLCJmaWxlcyIsImZpbGVOYW1lcyIsInJlYWRkaXJTeW5jIiwiZm9yRWFjaCIsImZpbGVOYW1lIiwicHVzaCIsImNoZWNrRmlsZUV4aXN0IiwicGF0aCIsImFjY2VzcyIsIkZfT0siLCJ1cGRhdGVBYmlsaXR5Qm9udXMiLCJteUFiaWxpdHkiLCJhYmlsaXR5IiwidmFsIiwibW9kaWZpZXIiLCJwYXJlbnQiLCJjaGlsZHJlbiIsInRleHQiLCJpc051bWVyaWMiLCJNYXRoIiwiZmxvb3IiLCJlYWNoIiwib24iLCJzZWxlY3QiLCJ1cGRhdGVQcm9mIiwiYXR0ciIsImNsZWFyVG9wIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsImNsaWNrIiwidHlwZSIsIm5ld0NhbXBhaWduIiwidG9EZWxldGUiLCJKU09OIiwic3RyaW5naWZ5IiwiY2FtcGFpZ25zIiwicGFyc2UiLCJjYW1wQXJyYXkiLCJuYW1lIiwiaHRtbCIsIm5vZGUiLCJpIiwidG9nZ2xlIiwib3Blbk1lIiwicHJvZkIiLCJzb21ldGhpbmdDbGV2ZXIiLCJjbGFzc2VzIiwiY3VycmVudENsYXNzIiwiY3VycmVudFBvcyIsImluQXJyYXkiLCJteVByb2YiLCJteVByb2ZTa2lsbEZsYWciLCJ0aGlzQWJpbGl0eSIsInRoaXNBYmlsaXR5Qm9udXNJRCIsInRoaXNBYmlsaXR5Qm9udXMiLCJuZXdWYWwiLCJwYXJzZUludCIsIm5ld1BvcyIsImxlbmd0aCIsIm5ld0NsYXNzIiwiYnV0dG9uT3B0aW9ucyIsIm15U3R5bGUiLCJteUlkIiwiJCIsInJlbW92ZUF0dHIiXSwibWFwcGluZ3MiOiJBQUFBLGEsQ0FDRTs7QUFDQSxJQUFJQSxFQUFFLEdBQUdDLE9BQU8sQ0FBQyxJQUFELENBQWhCLEMsQ0FFRjs7O0FBQ0EsSUFBSUMsZ0JBQWdCLEdBQUcsaUJBQXZCO0FBQ0EsSUFBSUMsUUFBUSxHQUFHLFNBQWY7QUFDQSxJQUFJQyxlQUFlLEdBQUcsYUFBdEIsQyxDQUVBO0FBRUE7O0FBQ0EsSUFBSUMsS0FBSyxHQUFHLEVBQVo7QUFDQSxJQUFJQyxHQUFHLEdBQUcsRUFBVjtBQUNBLElBQUlDLFdBQVcsR0FBRyxFQUFsQixDLENBQ0E7QUFFQTtBQUVBOztBQUlBQyxNQUFNLENBQUMsVUFBRCxDQUFOLENBQW1CQyxLQUFuQixDQUF5QixZQUFZO0FBQ25DRCxFQUFBQSxNQUFNLENBQUMsT0FBRCxDQUFOLENBQWdCRSxTQUFoQixDQUEwQjtBQUN0QkMsSUFBQUEsV0FBVyxFQUFFLFdBRFM7QUFFdEJDLElBQUFBLE1BQU0sRUFBRTtBQUZjLEdBQTFCO0FBTUQsQ0FQRDs7QUFTQUMsTUFBTSxDQUFDQyxTQUFQLENBQWlCQyxjQUFqQixHQUFrQyxVQUFTQyxRQUFULEVBQW1CO0FBQ3JELFNBQU8sS0FBS0EsUUFBTCxNQUFtQkMsU0FBMUI7QUFD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TUFBSVQsTUFBTSxHQUFHL0UsTUFBTSxDQUFDLElBQUQsQ0FBTixDQUFhNEMsTUFBYixHQUFzQkMsUUFBdEIsQ0FBK0IsVUFBL0IsQ0FBYjtBQUNBUSxFQUFBQSxVQUFVLENBQUNyRCxNQUFNLENBQUMrRSxNQUFELENBQVAsRUFBaUJPLE1BQWpCLENBQVY7QUFDSCxDQVREOzs7QUNwQ0E7QUFDQSxJQUFJRyxhQUFhLEdBQUcsQ0FBQyxTQUFELEVBQVksT0FBWixFQUFxQixNQUFyQixFQUE2QixPQUE3QixFQUFzQyxLQUF0QyxDQUFwQjtBQUNBekYsTUFBTSxDQUFDeUYsYUFBRCxDQUFOLENBQXNCdkMsSUFBdEIsQ0FBMkIsWUFBVztBQUNsQyxNQUFJd0MsT0FBTyxHQUFHLElBQWQ7QUFDQSxNQUFJQyxJQUFJLEdBQUcsTUFBTUQsT0FBakI7QUFDQTFGLEVBQUFBLE1BQU0sQ0FBQzJGLElBQUQsQ0FBTixDQUFheEMsRUFBYixDQUFnQixPQUFoQixFQUF5QixZQUFXO0FBQ2hDeUMsSUFBQUEsQ0FBQyxDQUFDLE1BQUQsQ0FBRCxDQUFVQyxVQUFWLENBQXFCLE9BQXJCO0FBQ0E3RixJQUFBQSxNQUFNLENBQUMsTUFBRCxDQUFOLENBQWV5RCxRQUFmLENBQXdCLFdBQVdpQyxPQUFuQztBQUNILEdBSEQ7QUFJSCxDQVBEIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuICAvLyByZW1vdmUgbGluZSBiZWxvdyB3aGVuIHRlc3RpbmcgZnJvbnRlbmRcclxuICB2YXIgZnMgPSByZXF1aXJlKCdmcycpO1xyXG4gIFxyXG4vLyBQYXRoc1xyXG5sZXQgY2FtcGFpZ25MaXN0UGF0aCA9IFwiLi9jYW1wYWlnbi5qc29uXCI7XHJcbmxldCBib29rUGF0aCA9IFwiLi9ib29rL1wiO1xyXG5sZXQgY2FtcGFpZ25EaXJQYXRoID0gXCIvY2FtcGFpZ25zL1wiO1xyXG5cclxuLy8vXHJcblxyXG4vL2dsb2RhbCBvYmplY3RzXHJcbnZhciBib29rcyA9IHt9O1xyXG52YXIgbnBjID0ge307XHJcbnZhciBjYW1wYWlnbk9iaiA9IHt9O1xyXG4vLy9cclxuXHJcbi8vZ2xvYmFsIHZhcnNcclxuXHJcbi8vL1xyXG5cclxuXHJcblxyXG5qUXVlcnkoXCJkb2N1bWVudFwiKS5yZWFkeShmdW5jdGlvbiAoKSB7XHJcbiAgalF1ZXJ5KFwiLmRyYWdcIikuZHJhZ2dhYmxlKHtcclxuICAgICAgY29udGFpbm1lbnQ6IFwiLm1haW5WaWV3XCIsXHJcbiAgICAgIHNjcm9sbDogZmFsc2VcclxuICB9KTtcclxuXHJcblxyXG59KTtcclxuXHJcbk9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkgPSBmdW5jdGlvbihwcm9wZXJ0eSkge1xyXG5yZXR1cm4gdGhpc1twcm9wZXJ0eV0gIT09IHVuZGVmaW5lZDtcclxufTtcclxuXHJcbi8vIGdldERpckNvbnRlbnRzKFwiLi9ib29rc1wiKS50aGVuKGZ1bmN0aW9uIChmaWxlcykge1xyXG4vLyAgIC8vIGNvbnNvbGUubG9nKCk7XHJcbi8vICAgLy8gY29uc29sZS5sb2coSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShmaWxlcy5maWxlc1swXS5uYW1lKSkpO1xyXG4vLyAgIGZvcih2YXIgaSA9IDA7IGkgPD0gZmlsZXMuZmlsZXMubGVuZ3RoIC0gMTsgaSsrKSB7XHJcbi8vICAgICByZWFkQUZpbGUoXCIuL2Jvb2tzL1wiICsgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShmaWxlcy5maWxlc1tpXS5uYW1lKSkpLnRoZW4oZnVuY3Rpb24gKGJvb2spIHtcclxuLy8gICAgICAgdmFyIGJvb2tUaXRsZSA9IEpTT04ucGFyc2UoYm9vayk7XHJcbi8vICAgICAgIGNvbnNvbGUubG9nKGJvb2tUaXRsZS5kZXRhaWxzLm5hbWUpO1xyXG4vLyAgICAgICBqUXVlcnkoXCIuYm9va0xpc3RcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiYm9va1wiPiR7Ym9va1RpdGxlLmRldGFpbHMubmFtZX08ZGl2PmApO1xyXG5cclxuLy8gICAgICAgIC8vbG9vayBmb3IgbnBjLCB0aGlzIHdpbGwgZXZlbnR1YWxseSBiZSBpdHMgb3duIGZ1bmN0aW9uXHJcbi8vICAgICAgIGlmKGJvb2tUaXRsZS5oYXNPd25Qcm9wZXJ0eShcIk5QQ1wiKSl7XHJcbi8vICAgICAgICAgY29uc29sZS5sb2coYm9va1RpdGxlLmRldGFpbHMubmFtZStcIiB0cnVlXCIpXHJcbi8vICAgICAgIH1lbHNle1xyXG4vLyAgICAgICAgIGNvbnNvbGUubG9nKFwibm9uZSBmb3VuZFwiKVxyXG4vLyAgICAgICB9XHJcblxyXG4vLyAgICAgfSk7XHJcbiAgIFxyXG5cclxuXHJcbi8vICAgfVxyXG4vLyB9KTtcclxuXHJcbiIsImpRdWVyeShkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcclxuICBcclxuICBzdGFydEFwcCgpLnRoZW4oKGRhdGEpPT57XHJcbiAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgIGNvbnNvbGUubG9nKGNhbXBhaWduT2JqKVxyXG4gIH0pO1xyXG4gXHJcbiAgfSlcclxuICBcclxuXHJcbiAgZnVuY3Rpb24gc3RhcnRBcHAoKXtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KT0+e1xyXG4gICAgICB0cnl7XHJcbiAgICAgICAgZ2V0Q2FtcGFpZ25zKGNhbXBhaWduTGlzdFBhdGgpO1xyXG4gICAgICAgIHJlc29sdmUoXCJzdGFydFVwXCIpO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcil7XHJcbiAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIFxyXG4gIH0iLCIndXNlIHN0cmljdCc7XHJcblxyXG5mdW5jdGlvbiByZWFkQUZpbGUoZmlsZXBhdGgpe1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICBmcy5yZWFkRmlsZShmaWxlcGF0aCwgJ3V0Zi04JywgZnVuY3Rpb24oZXJyLCBkYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIHJlamVjdChcIkFuIGVycm9yIG9jdXJyZWQgcmVhZGluZyB0aGUgZmlsZSA6XCIgKyBlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gd3JpdGVGaWxlKGZpbGVwYXRoLCBkYXRhKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBmcy53cml0ZUZpbGUoZmlsZXBhdGgsIGRhdGEsIChlcnIpID0+IHtcclxuICAgICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXREaXJDb250ZW50cyhkaXIpe1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpPT57XHJcbiAgICAgICAgdmFyIGZpbGVzID0ge307XHJcbiAgICAgICAgdmFyIGZpbGVOYW1lcyA9IFtdO1xyXG4gICAgICAgIHRyeXtcclxuICAgICAgICAgICAgZnMucmVhZGRpclN5bmMoZGlyKS5mb3JFYWNoKChmaWxlTmFtZSk9PntcclxuICAgICAgICAgICAgICAgIGZpbGVOYW1lcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjpmaWxlTmFtZVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIGZpbGVzID0ge1wiZmlsZXNcIjpmaWxlTmFtZXN9XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmVzb2x2ZShmaWxlcyk7XHJcbiAgICAgICAgfWNhdGNoKGVycm9yKXtcclxuICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBjaGVja0ZpbGVFeGlzdChwYXRoKXtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KT0+e1xyXG4gICAgICAgaWYoIXBhdGgpe1xyXG4gICAgICAgICAgICAgcmVqZWN0KFwiUGF0aCBpcyBpbnZhbGlkIFwiK3BhdGgpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyeXtcclxuICAgICAgICAgICAgZnMuYWNjZXNzKHBhdGgsIGZzLkZfT0ssIChlcnIpPT57XHJcbiAgICAgICAgICAgICAgICBpZihlcnIpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoXCJmYWxzZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJlc29sdmUoXCJ0cnVlXCIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9Y2F0Y2ggKGVycm9yKXtcclxuICAgICAgICAgICAgcmVqZWN0KFwiZXJyb3JcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuLy93cml0ZSB0ZXN0XHJcbi8vIHZhciB0ZXN0T2JqICA9IFwiVGhpcyBpcyBhIHdyaXRlIHRlc3RcIjtcclxuLy8gd3JpdGVGaWxlKFwiLi4vdGVzdC50eHRcIiwgdGVzdE9iaik7XHJcbiIsIlxyXG5mdW5jdGlvbiB1cGRhdGVBYmlsaXR5Qm9udXMobXlBYmlsaXR5KSB7XHJcbiAgICB2YXIgYWJpbGl0eSA9IGpRdWVyeShteUFiaWxpdHkpLnZhbCgpO1xyXG5cclxuICAgIHZhciBtb2RpZmllciA9IGpRdWVyeShteUFiaWxpdHkpLnBhcmVudCgpLmNoaWxkcmVuKCcubW9kaWZpZXItYnViYmxlJykudGV4dCgpO1xyXG4gICAgaWYgKCFqUXVlcnkuaXNOdW1lcmljKGFiaWxpdHkpKSB7XHJcbiAgICAgICAgYWJpbGl0eSA9IDE7XHJcbiAgICAgICAgalF1ZXJ5KG15QWJpbGl0eSkudmFsKGFiaWxpdHkpO1xyXG4gICAgfVxyXG5cclxuICAgIG1vZGlmaWVyID0gTWF0aC5mbG9vcigoYWJpbGl0eSAtIDEwKSAvIDIpO1xyXG4gICAgalF1ZXJ5KG15QWJpbGl0eSkucGFyZW50KCkuY2hpbGRyZW4oJy5tb2RpZmllci1idWJibGUnKS50ZXh0KG1vZGlmaWVyKTtcclxufTtcclxuXHJcblxyXG5qUXVlcnkoXCIuYWJpbGl0eVwiKS5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgdXBkYXRlQWJpbGl0eUJvbnVzKGpRdWVyeSh0aGlzKSk7XHJcblxyXG4gICAgalF1ZXJ5KHRoaXMpLm9uKFwiZm9jdXNcIiwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgalF1ZXJ5KHRoaXMpLnNlbGVjdCgpO1xyXG4gICAgfSlcclxuICAgIGpRdWVyeSh0aGlzKS5vbihcImtleXVwXCIsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHVwZGF0ZUFiaWxpdHlCb251cyhqUXVlcnkodGhpcykpO1xyXG4gICAgICAgIHVwZGF0ZVByb2YoalF1ZXJ5KCcuc2F2aW5nVGhyb3dzICMnK2pRdWVyeSh0aGlzKS5hdHRyKCdpZCcpKSk7XHJcbiAgICB9KTtcclxufSk7XHJcbiIsImZ1bmN0aW9uIGNsZWFyVG9wKCkge1xyXG4gICAgalF1ZXJ5KFwiLmRyYWdcIikuZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgICBqUXVlcnkodGhpcykucmVtb3ZlQ2xhc3MoXCJvblRvcFwiKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxualF1ZXJ5KFwiLmRyYWdcIikub24oXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oKSB7XHJcbiAgICBjbGVhclRvcCgpO1xyXG4gICAgalF1ZXJ5KHRoaXMpLmFkZENsYXNzKFwib25Ub3BcIik7XHJcbn0pO1xyXG4iLCJqUXVlcnkoXCIuY2FtcGFpZ25CdXR0b25cIikuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHR5cGUgPSBqUXVlcnkodGhpcykuYXR0cihcImRhdGEtY2FtcGFpZ25cIik7XHJcbiAgICBpZiAodHlwZSA9PSBcIm5ld1wiKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJjbGlja2VkIG5ldyB5b3UgYmFzdGFyZFwiKVxyXG4gICAgICAgIG5ld0NhbXBhaWduKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiY29taW5nIHNvb25cIik7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxualF1ZXJ5KFwiLmNhbXBEZWxldGVcIikuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHRvRGVsZXRlID0galF1ZXJ5KHRoaXMpLmF0dHIoXCJkYXRhLWRlbGV0ZVwiKTtcclxuICAgIGNvbnNvbGUubG9nKFwiZGVsZXQgdGhpcyBudW1iZXIgXCIgKyB0b0RlbGV0ZSArIFwiIGFuZCB0aGlzIGlzIHRoZSBvYmplY3RcIiArIEpTT04uc3RyaW5naWZ5KGNhbXBhaWduT2JqKSlcclxufSlcclxuXHJcbmZ1bmN0aW9uIG5ld0NhbXBhaWduKCkge1xyXG5cclxuXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldENhbXBhaWducyhwYXRoKSB7XHJcbiAgICAvLyBjb25zb2xlLmxvZyhcImdldENhbXBhaWducyBcIiArIHBhdGgpO1xyXG4gICAgY2hlY2tGaWxlRXhpc3QocGF0aCkudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgIGlmIChkYXRhID09IFwidHJ1ZVwiKSB7XHJcbiAgICAgICAgICAgIHJlYWRBRmlsZShwYXRoKS50aGVuKChjYW1wYWlnbnMpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBjYW1wYWlnbnMgPSBKU09OLnBhcnNlKGNhbXBhaWducyk7XHJcbiAgICAgICAgICAgICAgICBjYW1wYWlnbk9iaiA9IGNhbXBhaWducztcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGNhbXBhaWducykpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNhbXBBcnJheSA9IGNhbXBhaWducy5jYW1wYWlnbnM7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjYW1wYWlnbnMuY2FtcGFpZ25zWzBdLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGh0bWwgPSBcIjx0YWJsZT5cIjtcclxuICAgICAgICAgICAgICAgIGNhbXBBcnJheS5mb3JFYWNoKGZ1bmN0aW9uIChub2RlLCBpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coY2FtcGFpZ25zLmNhbXBhaWduc1tpXS5uYW1lKVxyXG4gICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gXCI8dHI+PHRkPlwiICsgY2FtcGFpZ25zLmNhbXBhaWduc1tpXS5uYW1lICsgXCI8L3RkPjx0ZD48YnV0dG9uIHR5cGU9J2J1dHRvbicgZGF0YS1sb2FkPSdcIiArIGNhbXBhaWducy5jYW1wYWlnbnNbaV0ubmFtZSArIFwiJyBjbGFzcz0nYnRuIGJ0bi1wcmltYXJ5IGNhbXBMb2FkJz5Mb2FkPC9idXR0b24+PGJ1dHRvbiB0eXBlPSdidXR0b24nIGRhdGEtZGVsZXRlPSdcIiArIGkgKyBcIicgY2xhc3M9J2J0biBidG4tcHJpbWFyeSBjYW1wRGVsZXRlJz5EZWxldGU8L2J1dHRvbj48L3RkPjwvdHI+XCI7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgIGh0bWwgKz0gXCI8L3RhYmxlPlwiO1xyXG4gICAgICAgICAgICAgICAgalF1ZXJ5KFwiLmNhbXBhaWduU2VsZWN0b3JCb3hcIikuaHRtbChodG1sKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBcImNhbXBhaWducyBzZXRcIjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG59XHJcblxyXG4iLCJqUXVlcnkoXCIuY2xvc2VcIikuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgalF1ZXJ5KHRoaXMpLnBhcmVudCgpLnRvZ2dsZSgpO1xyXG59KVxyXG5qUXVlcnkoXCIubWVudSBidXR0b25cIikuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG9wZW5NZSA9IGpRdWVyeSh0aGlzKS5hdHRyKFwiZGF0YS1vcGVuXCIpO1xyXG4gICAgalF1ZXJ5KFwiLlwiICsgb3Blbk1lKS50b2dnbGUoKTtcclxuICAgIGNsZWFyVG9wKCk7XHJcbiAgICBqUXVlcnkoXCIuXCIgKyBvcGVuTWUpLmFkZENsYXNzKFwib25Ub3BcIik7XHJcbn0pOyIsIiIsInZhciBwcm9mQiA9IGpRdWVyeSgnI3Byb2ZCb251cycpLnZhbCgpO1xyXG5zb21ldGhpbmdDbGV2ZXIoKTtcclxuXHJcbmpRdWVyeSgnI3Byb2ZCb251cycpLm9uKFwia2V5dXBcIiwgZnVuY3Rpb24oKSB7XHJcbiAgICBwcm9mQiA9IGpRdWVyeSgnI3Byb2ZCb251cycpLnZhbCgpO1xyXG4gICAgc29tZXRoaW5nQ2xldmVyKCk7XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gc29tZXRoaW5nQ2xldmVyKCkge1xyXG4gICAgalF1ZXJ5KCcuaWNvbi1wcm9mJykuZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgY2xhc3NlcyA9IFsnaWNvbi1wcm9mJywgJ2ljb24tcHJvZiBwcm9maWNpZW50JywgJ2ljb24tcHJvZiBleHBlcnRpc2UnXTtcclxuICAgICAgICB2YXIgY3VycmVudENsYXNzID0galF1ZXJ5KHRoaXMpLmF0dHIoJ2NsYXNzJyk7XHJcbiAgICAgICAgdmFyIGN1cnJlbnRQb3MgPSBqUXVlcnkuaW5BcnJheShjdXJyZW50Q2xhc3MsIGNsYXNzZXMpO1xyXG4gICAgICAgIHZhciBteVByb2YgPSBqUXVlcnkodGhpcykucGFyZW50KCkuY2hpbGRyZW4oJy5wcm9mVmFsJyk7XHJcbiAgICAgICAgdXBkYXRlUHJvZihqUXVlcnkobXlQcm9mKSwgY3VycmVudFBvcyk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlUHJvZihteVByb2YsIG15UHJvZlNraWxsRmxhZykge1xyXG4gICAgdmFyIHRoaXNBYmlsaXR5ID0galF1ZXJ5KG15UHJvZikuYXR0cignaWQnKTtcclxuICAgIHZhciB0aGlzQWJpbGl0eUJvbnVzSUQgPSAnIycgKyB0aGlzQWJpbGl0eSArICctQm9udXMnO1xyXG4gICAgdmFyIHRoaXNBYmlsaXR5Qm9udXMgPSBqUXVlcnkoJy5hYmlsaXRpZXMgJyArIHRoaXNBYmlsaXR5Qm9udXNJRCkudGV4dCgpO1xyXG4gICAgdmFyIG5ld1ZhbCA9IHBhcnNlSW50KHRoaXNBYmlsaXR5Qm9udXMpO1xyXG4gICAgaWYgKG15UHJvZlNraWxsRmxhZyA9PSAwKSB7XHJcbiAgICAgICAgdmFyIG5ld1ZhbCA9IHBhcnNlSW50KHRoaXNBYmlsaXR5Qm9udXMpO1xyXG4gICAgfVxyXG4gICAgaWYgKG15UHJvZlNraWxsRmxhZyA9PSAxKSB7XHJcbiAgICAgICAgdmFyIG5ld1ZhbCA9IHBhcnNlSW50KHByb2ZCKSArIHBhcnNlSW50KHRoaXNBYmlsaXR5Qm9udXMpO1xyXG4gICAgfVxyXG4gICAgaWYgKG15UHJvZlNraWxsRmxhZyA9PSAyKSB7XHJcbiAgICAgICAgdmFyIG5ld1ZhbCA9IHBhcnNlSW50KHByb2ZCKSAqIDIgKyAocGFyc2VJbnQodGhpc0FiaWxpdHlCb251cykpO1xyXG4gICAgfVxyXG4gICAgalF1ZXJ5KG15UHJvZikudGV4dChuZXdWYWwpO1xyXG59O1xyXG5cclxuXHJcbmpRdWVyeSgnLmljb24tcHJvZicpLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIGNsYXNzZXMgPSBbJ2ljb24tcHJvZicsICdpY29uLXByb2YgcHJvZmljaWVudCcsICdpY29uLXByb2YgZXhwZXJ0aXNlJ107XHJcbiAgICB2YXIgY3VycmVudENsYXNzID0galF1ZXJ5KHRoaXMpLmF0dHIoJ2NsYXNzJyk7XHJcbiAgICB2YXIgY3VycmVudFBvcyA9IGpRdWVyeS5pbkFycmF5KGN1cnJlbnRDbGFzcywgY2xhc3Nlcyk7XHJcbiAgICB2YXIgbmV3UG9zID0gKChjdXJyZW50UG9zICsgMSkgJSBjbGFzc2VzLmxlbmd0aCk7XHJcbiAgICB2YXIgbmV3Q2xhc3MgPSBjbGFzc2VzW25ld1Bvc107XHJcbiAgICBqUXVlcnkodGhpcykuYXR0cignY2xhc3MnLCBuZXdDbGFzcyk7XHJcbiAgICB2YXIgbXlQcm9mID0galF1ZXJ5KHRoaXMpLnBhcmVudCgpLmNoaWxkcmVuKCcucHJvZlZhbCcpO1xyXG4gICAgdXBkYXRlUHJvZihqUXVlcnkobXlQcm9mKSwgbmV3UG9zKTtcclxufSk7XHJcbiIsIi8vdGhlbWVzXHJcbnZhciBidXR0b25PcHRpb25zID0gWydkZWZhdWx0JywgJ2JsYWNrJywgJ2dyYXknLCAnbGlnaHQnLCAncmVkJ107XHJcbmpRdWVyeShidXR0b25PcHRpb25zKS5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIG15U3R5bGUgPSB0aGlzO1xyXG4gICAgdmFyIG15SWQgPSAnIycgKyBteVN0eWxlO1xyXG4gICAgalF1ZXJ5KG15SWQpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJChcImJvZHlcIikucmVtb3ZlQXR0cignY2xhc3MnKTtcclxuICAgICAgICBqUXVlcnkoJ2JvZHknKS5hZGRDbGFzcygndGhlbWUtJyArIG15U3R5bGUpO1xyXG4gICAgfSlcclxufSlcclxuIl19
